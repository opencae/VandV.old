# Source tutorial run functions
. $WM_PROJECT_DIR/bin/tools/RunFunctions

application=`getApplication`

# Create mesh
runApplication ./makeMesh

# Copy uninitialized fields to 0
rm -rf 0
cp -pr org0 0

# Set initial conditions
runApplication setDiscreteFields

# Run
if [ "x$1" = "x-parallel" ]
then
    runApplication decomposePar
    runParallel $application 4
    runApplication reconstructPar
else
    runApplication $application
fi

# Sample
runApplication foamCalc mag U -latestTime
runApplication foamLog log.simpleFoam
runApplication sample -latestTime

# Postprocessing
paste measured/UMeasured0deg.txt sets/*/horizontal_k_magU.xy > horizontal_magU_processed.txt
gnuplot plotHorizontalU.gp
gnuplot res.gp
